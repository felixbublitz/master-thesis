import { SequenceLogger } from "../../logging/sequence_logger";
import { Helper } from "../../etc/helper";
import { RenderObject } from "../../renderer/renderer";
import { RenderModel } from "../../renderer/render_model";
const Homography = require("homography/Homography");
const PNG = require('pngjs').PNG;
import {FACE_MESH_INDEX_BUFFER, FACE_MESH_EYE_R_INDEX_BUFFER,FACE_MESH_UV} from "../../etc/face_geom"


export class AffineReenactment implements RenderModel{

  domRenderer : HTMLCanvasElement = document.createElement('canvas');
  private width = 500;
  private height = 500;
  private renderer : THREE.WebGLRenderer;
  private homography : any;
  private sourceImage : HTMLImageElement;
  private imageLoaded = false;
  private sourcePoints  : any;
  private done = false;

  constructor(){
      this.domRenderer.width = this.width;
      this.domRenderer.height = this.height;
      this.homography = new Homography.Homography("piecewiseaffine");
      this.sourcePoints = []

      this.sourceImage = new Image();
      this.sourceImage.onload = ()=>{
        const points = [[166.45740867, 125.73560715],
        [165.70837355, 112.60073304],
        [165.99611843, 115.83526254],
        [163.32254183, 100.23113608],
        [165.69715261, 108.89684916],
        [165.85147834, 103.89967918],
        [166.45460343,  91.74679399],
        [144.10996538,  90.62857032],
        [166.73683262,  83.94672632],
        [166.80201638,  79.28557277],
        [167.35282767,  60.16557992],
        [166.41061056, 126.75890207],
        [166.37380135, 127.68515468],
        [166.3795445 , 128.26151848],
        [166.34360719, 128.25262427],
        [166.26172471, 129.34667587],
        [166.15305984, 130.6498754 ],
        [166.06985056, 132.12868452],
        [166.05825055, 136.58555031],
        [165.82071555, 114.38553929],
        [162.80482471, 114.07932758],
        [133.58896744,  76.66127801],
        [153.52694303,  93.65724564],
        [150.17920071,  94.05047894],
        [147.01080376,  93.90014648],
        [143.02581865,  91.88033581],
        [156.3716104 ,  92.77302861],
        [147.97387058,  84.63929415],
        [151.9147017 ,  84.88895416],
        [144.56102031,  85.28419375],
        [142.53043914,  86.50965214],
        [140.61248428,  94.0274334 ],
        [154.49016148, 142.42533088],
        [143.00524378,  89.69555855],
        [132.40362382,  92.28888988],
        [137.22979027,  91.7127192 ],
        [150.74382019, 108.63654613],
        [162.56708121, 124.83577967],
        [162.9552269 , 127.35244274],
        [159.04541445, 125.50122499],
        [156.68786252, 126.31058693],
        [160.08892322, 127.2098887 ],
        [157.80725473, 127.25501418],
        [151.96270341, 130.75046897],
        [162.97977269, 112.44373798],
        [162.48891377, 108.89546514],
        [137.9395237 ,  84.37775731],
        [157.34864652,  99.52621937],
        [155.68707669, 110.94872832],
        [155.65382141, 108.91542077],
        [141.61982828, 108.03360701],
        [162.87738168, 104.25494313],
        [145.07002795,  81.39999032],
        [140.65019381,  82.31918335],
        [136.22320443,  70.35661697],
        [159.70206642,  84.27804351],
        [155.40979457,  86.14114344],
        [149.46239734, 127.64314055],
        [136.25977671, 125.82233906],
        [158.14169347, 113.02303076],
        [160.72203398, 114.14308906],
        [153.70369166, 127.66034961],
        [154.43092936, 127.64356971],
        [139.05804402,  80.0831759 ],
        [155.62522888, 112.44179606],
        [151.35646033,  81.84938908],
        [150.62155563,  78.98860931],
        [148.65014023,  62.04989612],
        [138.10477656,  74.37555313],
        [150.30176854,  69.43148553],
        [136.3702991 ,  82.64470696],
        [135.25696278,  79.36306715],
        [162.67987812, 126.28217697],
        [159.56045902, 126.44859195],
        [157.21951103, 126.81010008],
        [158.89947599, 113.65852118],
        [154.07612425, 127.65438437],
        [155.44011194, 128.21860313],
        [154.82182342, 127.63806581],
        [159.65777028, 112.0477581 ],
        [158.28319663, 127.56970167],
        [160.54122913, 127.68541217],
        [163.25373781, 127.98073411],
        [161.98744047, 136.40125036],
        [162.36400509, 131.82196856],
        [162.55720603, 130.30763626],
        [162.8550725 , 129.04661179],
        [163.23127699, 127.99017549],
        [158.27166295, 127.62961149],
        [157.69668496, 128.13649535],
        [157.09248894, 128.82840872],
        [156.58483654, 129.69646811],
        [152.8605296 , 121.83023572],
        [133.12559223, 108.06460261],
        [165.91383791, 115.09156108],
        [156.61694509, 127.62748718],
        [156.03276479, 127.89131999],
        [161.78859115, 115.58683634],
        [156.92813641, 114.52584028],
        [161.28059757, 114.88155484],
        [154.05666769, 101.60342932],
        [148.90910304, 103.99004817],
        [155.18690175, 110.44435501],
        [140.9854002 ,  65.32735705],
        [142.88242006,  70.88922322],
        [143.97900081,  78.59114349],
        [154.61857671, 132.8611207 ],
        [158.38057423,  79.75101113],
        [158.07852834,  69.13858294],
        [157.14920014,  60.48582494],
        [144.44129562,  93.21927309],
        [137.43460071,  96.35444283],
        [158.19827199,  91.93099737],
        [139.67522371,  87.91362226],
        [159.52615178,  97.20470309],
        [157.5834142 , 109.78664517],
        [134.42284191,  99.0755868 ],
        [139.33660555,  98.95067096],
        [143.17816365, 100.41982412],
        [149.23392248,  99.96203542],
        [153.83121604,  98.51826668],
        [157.20673585,  96.92264199],
        [163.42889428,  92.59452224],
        [134.90157008, 106.62724972],
        [137.38939476,  87.5707233 ],
        [164.14987707, 114.22567964],
        [157.3212955 , 103.17329407],
        [132.18468297,  91.88016415],
        [159.67306638,  95.1598835 ],
        [155.16508538, 110.54428339],
        [141.77005988,  89.95893002],
        [157.64130056, 107.34132886],
        [134.23606646, 116.7744112 ],
        [158.26560706,  90.67638874],
        [160.17544949, 105.42785168],
        [141.72077876, 134.27311063],
        [142.45826125, 138.23294163],
        [132.7223779 , 107.53792405],
        [138.13718837, 129.48117256],
        [133.77283341,  85.2241981 ],
        [153.85843438, 146.04627013],
        [164.57077575, 114.92806435],
        [154.52426022, 105.80000281],
        [135.04795396,  92.03535676],
        [147.17803735,  91.85240865],
        [150.0211789 ,  92.05291986],
        [154.91063368, 128.66499782],
        [135.58088189, 113.90836358],
        [159.66556048, 150.82387447],
        [150.61417294, 146.21014237],
        [146.81352764, 142.95432687],
        [167.02969515,  69.29391503],
        [166.34472549, 151.51660323],
        [152.90160352,  91.71381354],
        [155.65984887,  91.15013123],
        [157.43404502,  90.9077239 ],
        [135.60567409,  86.64319396],
        [155.07896662,  88.26514721],
        [152.09648269,  87.34514952],
        [149.08234513,  87.1920383 ],
        [146.19217801,  87.74110794],
        [144.52465653,  88.56223941],
        [132.42600882,  83.42306256],
        [145.32993847,  91.28516436],
        [165.98554194, 118.82789969],
        [155.83930796, 119.85353351],
        [158.12836862, 112.4720192 ],
        [161.55060124, 118.90862346],
        [166.67047369,  87.70115912],
        [145.6971302 , 138.98154616],
        [149.61794561, 142.60004997],
        [159.33535802, 148.44416499],
        [139.11353266, 132.97985673],
        [157.23670256,  89.67248619],
        [161.23984587,  98.36422205],
        [166.20791352, 149.02518511],
        [154.71287423, 148.95341992],
        [133.80771875, 115.49549103],
        [160.5253644 , 127.72712588],
        [159.93863475, 128.5532999 ],
        [159.48907721, 129.59530592],
        [159.14037538, 130.95117331],
        [157.86685646, 134.86415148],
        [156.02424484, 127.40564704],
        [155.43611258, 127.21740961],
        [154.96985632, 126.9802916 ],
        [150.54403263, 124.52311993],
        [139.28015971, 115.82020998],
        [161.54101038,  94.63007212],
        [160.27425814,  88.44002724],
        [158.43976843,  88.65274787],
        [156.64457095, 127.57355332],
        [139.0671705 , 124.42177534],
        [162.62561202,  88.65949094],
        [156.12223846, 138.6030972 ],
        [166.06181395,  99.7092104 ],
        [163.3161732 ,  96.54230475],
        [166.24843776,  95.80190778],
        [158.90177894, 104.10565138],
        [166.08823621, 145.33072114],
        [166.07022965, 140.71765423],
        [160.8984983 , 140.45049548],
        [148.96865737, 132.33008623],
        [152.64891458, 113.42254043],
        [152.30816406, 135.9575057 ],
        [145.733693  , 112.78650284],
        [149.78048801, 117.02711821],
        [143.08178115, 118.5641098 ],
        [159.73303771, 144.88930464],
        [157.07531637, 106.0410583 ],
        [146.4306702 , 134.99450684],
        [150.45954394, 138.95471334],
        [146.36462402, 128.03320885],
        [136.43955803, 120.06710172],
        [142.72053158, 128.36186528],
        [135.30912495, 122.83101082],
        [147.2942934 , 121.69686556],
        [159.36945677, 100.70459962],
        [158.61306739, 111.43506646],
        [156.66715497, 112.1773088 ],
        [159.85895097, 109.18886662],
        [157.4662199 ,  85.83648205],
        [151.72369945,  83.91808033],
        [146.74173832,  83.57193053],
        [142.88270438,  84.22247887],
        [140.47285759,  85.63777328],
        [139.7921716 ,  90.83763242],
        [132.10676193,  99.83836412],
        [142.23325503,  95.59465885],
        [145.40783107,  96.69495463],
        [149.68939376,  96.72834277],
        [153.81931275,  95.87450981],
        [157.03653592,  94.71732974],
        [159.19064212,  93.63868475],
        [132.61340976,  99.91672754],
        [156.76783061, 113.06697607],
        [160.97780299, 101.81534529],
        [160.75757325, 111.80087686],
        [162.57722175, 113.53594422],
        [160.89021528, 112.32340336],
        [157.7510553 , 114.10212636],
        [163.146703  , 113.93366218],
        [163.53426111, 114.64662552],
        [159.31365538,  90.89766026],
        [160.807006  ,  91.81030869],
        [161.48623252,  92.56476045],
        [143.64853299,  89.17374551],
        [141.389458  ,  87.98058093],
        [168.8925215 , 100.26121974],
        [191.46642101,  90.87029099],
        [169.25981748, 114.13651228],
        [204.28631687,  76.61469877],
        [181.56364524,  93.95388722],
        [184.87802804,  94.36884642],
        [188.14419115,  94.29153442],
        [192.74329484,  91.99744105],
        [178.79994106,  93.0611515 ],
        [186.93428278,  84.16803002],
        [182.96955979,  84.53064322],
        [190.51065159,  84.79910016],
        [192.76814389,  86.11596823],
        [195.21025085,  94.28187847],
        [178.63807154, 142.96210527],
        [192.81194723,  89.65676308],
        [205.13853908,  92.58761287],
        [199.12148488,  91.80898905],
        [182.99203956, 108.95169497],
        [170.49607229, 124.97210026],
        [169.94476819, 127.51040339],
        [174.18091643, 125.79999089],
        [176.64336133, 126.73966527],
        [173.00793099, 127.51183033],
        [175.44376409, 127.68267632],
        [181.39193845, 131.28812313],
        [168.5413177 , 112.50054717],
        [168.92876208, 108.93797278],
        [197.16299629,  83.94090056],
        [176.56123245,  99.63290691],
        [176.99778736, 111.15058064],
        [177.2563237 , 109.10333633],
        [192.97770238, 108.51025701],
        [168.91420519, 104.28210855],
        [188.85647392,  80.86579084],
        [193.79154217,  81.78829908],
        [200.96765041,  70.24629772],
        [173.77046156,  84.1214776 ],
        [179.58432591,  86.02799714],
        [184.04957449, 128.19181323],
        [202.22469807, 126.48776293],
        [174.49733913, 113.18199992],
        [171.71735322, 114.26003337],
        [179.84657729, 128.31565619],
        [179.10637486, 128.26670051],
        [195.63748026,  79.54036117],
        [177.27215052, 112.67989039],
        [182.26372147,  81.45288885],
        [182.80990791,  78.68533731],
        [186.88490689,  61.93317175],
        [198.07192969,  74.45787549],
        [184.3372246 ,  69.49821353],
        [199.17165685,  82.24982142],
        [201.62049258,  79.51365709],
        [170.26246083, 126.43094301],
        [173.57932663, 126.75158501],
        [176.04886043, 127.23383546],
        [173.70474708, 113.82456064],
        [179.46500874, 128.29547524],
        [177.83116901, 128.78051519],
        [178.69963503, 128.24252844],
        [172.58445454, 112.15500355],
        [174.95417511, 127.9758954 ],
        [172.51762176, 127.96863198],
        [169.64324355, 128.12497258],
        [170.33911192, 136.59903646],
        [169.9031446 , 132.00298548],
        [169.84794974, 130.4713583 ],
        [169.75338686, 129.19185877],
        [169.57330227, 128.12725782],
        [174.87850964, 128.04035425],
        [175.40765619, 128.56780529],
        [175.91299617, 129.29133654],
        [176.32430398, 130.18848181],
        [180.08665216, 122.18970537],
        [205.86486697, 108.53296995],
        [176.7300961 , 128.13556194],
        [177.26923156, 128.42297673],
        [170.52895796, 115.69564819],
        [176.04707873, 114.79715109],
        [171.1036706 , 115.00371337],
        [179.9957664 , 101.77917838],
        [185.25364494, 104.29658175],
        [177.91998875, 110.68963766],
        [195.4187479 ,  65.19018888],
        [192.55841482,  70.97098231],
        [189.99407172,  78.11686456],
        [178.38234043, 133.341676  ],
        [174.80136573,  79.66012716],
        [176.13591743,  69.17441726],
        [177.84739387,  60.41401148],
        [191.04288769,  93.55063319],
        [198.69836855,  96.71497464],
        [177.00567234,  92.24681139],
        [195.90238523,  87.70225346],
        [174.19863868,  97.27437615],
        [174.6848917 , 109.94278193],
        [201.86644328,  99.52170253],
        [196.15872288,  99.38454509],
        [191.64483762, 100.85065126],
        [185.23038805, 100.28173327],
        [180.61957061,  98.75113606],
        [177.20882428,  97.15589762],
        [169.65099585,  92.62366176],
        [201.14182127, 107.18225241],
        [198.42353153,  87.41186678],
        [167.52773774, 114.26456094],
        [176.22849011, 103.29295278],
        [206.57025039,  92.05754399],
        [174.59728503,  95.43604374],
        [178.25197291, 110.8057344 ],
        [194.15944469,  89.83561277],
        [174.92417049, 107.47345448],
        [204.64205074, 117.37637401],
        [177.15410328,  91.01970077],
        [171.91389012, 105.50970197],
        [193.91758811, 135.03452539],
        [194.11109233, 139.01878595],
        [204.70816326, 108.07540655],
        [198.28853917, 130.16364455],
        [203.47177577,  85.42052507],
        [179.52363431, 146.64032578],
        [167.30771649, 114.949404  ],
        [179.18740439, 106.0165    ],
        [201.99508595,  92.32266426],
        [187.93597841,  92.31718183],
        [184.98299682,  92.46641994],
        [178.34682012, 129.25152183],
        [200.52978766, 114.51800823],
        [173.34306157, 151.14842176],
        [184.00535417, 146.89982414],
        [188.73179269, 143.74004245],
        [182.19956124,  92.07690954],
        [179.60864425,  91.49096489],
        [177.92527699,  91.2633419 ],
        [200.78599262,  86.48482561],
        [180.38745654,  88.23485434],
        [183.3290087 ,  87.0231986 ],
        [186.31040275,  86.79659486],
        [189.25525296,  87.36199915],
        [191.02776217,  88.29400241],
        [205.89661539,  83.45800638],
        [190.01029658,  91.67761445],
        [176.92957091, 120.12812734],
        [174.40810239, 112.62735128],
        [170.63877904, 119.02877569],
        [189.2346307 , 139.77265835],
        [184.59456682, 143.34684134],
        [173.37975705, 148.78180146],
        [198.51534605, 133.67350817],
        [178.18023098,  89.94374871],
        [171.70565844,  98.42409968],
        [178.96797073, 149.48797345],
        [203.5784694 , 116.1105752 ],
        [172.44955695, 128.00486326],
        [172.89593017, 128.84378314],
        [173.1994071 , 129.91087317],
        [173.41969371, 131.29417419],
        [174.74410486, 135.22184014],
        [177.40731347, 127.9207921 ],
        [177.98251891, 127.74477482],
        [178.49879551, 127.51999497],
        [182.6618371 , 124.97587681],
        [195.73837388, 116.38994336],
        [171.86250508,  94.68596935],
        [174.41426253,  88.68320167],
        [176.6950686 ,  88.85563016],
        [176.7801733 , 128.07531953],
        [196.46669197, 125.04414439],
        [171.08968234,  88.92074347],
        [176.80858576, 139.05721664],
        [169.30030382,  96.56719565],
        [174.02234495, 104.22609329],
        [171.51323462, 140.69257021],
        [184.78412855, 132.95854926],
        [180.81769967, 113.73768926],
        [181.11041057, 136.53291464],
        [188.17152321, 113.22756529],
        [183.68582296, 117.42977142],
        [191.17842972, 119.12022829],
        [172.74012601, 145.19563437],
        [176.21603715, 106.17795825],
        [187.90680778, 135.70970178],
        [183.31124854, 139.62174654],
        [187.53562617, 128.66168261],
        [199.74714661, 120.68338752],
        [191.96154463, 129.04162288],
        [201.84826612, 123.46072912],
        [186.37238324, 122.20676422],
        [173.90450621, 100.79996824],
        [173.59507763, 111.56196713],
        [175.90736675, 112.37149   ],
        [171.96351242, 109.28977132],
        [176.99500108,  85.83221197],
        [182.57883632,  83.61677706],
        [187.60012758,  83.11231792],
        [191.73547697,  83.74854326],
        [194.57670414,  85.23815632],
        [196.22362232,  90.82343817],
        [205.36807537, 100.25563002],
        [193.25612175,  95.91653466],
        [189.62482345,  97.07725525],
        [185.14679968,  97.02672243],
        [181.01565814,  96.11297965],
        [177.86058605,  94.95925426],
        [175.649418  ,  93.89746428],
        [206.39331222, 100.23406506],
        [175.93955112, 113.26999784],
        [171.53594184, 101.88300133],
        [171.03848684, 111.90538645],
        [169.36990392, 113.63146305],
        [171.14809942, 112.44415641],
        [175.01729286, 114.31139231],
        [168.63182437, 114.00275588],
        [168.42628419, 114.68874693],
        [175.88858306,  91.20746613],
        [173.92395329,  92.09795952],
        [172.60911405,  92.87960887],
        [192.02043557,  89.02762413],
        [194.16291332,  87.72403836]];

        console.log(FACE_MESH_INDEX_BUFFER.length);


       /* for(let i=0; i<FACE_MESH_INDEX_BUFFER.length; i+=3){
          ctx.beginPath();
          ctx.moveTo(this.sourcePoints[FACE_MESH_INDEX_BUFFER[i]][0], this.sourcePoints[FACE_MESH_INDEX_BUFFER[i]][1]);
          ctx.lineTo(this.sourcePoints[FACE_MESH_INDEX_BUFFER[i+1]][0], this.sourcePoints[FACE_MESH_INDEX_BUFFER[i+1]][1]);
          ctx.lineTo(this.sourcePoints[FACE_MESH_INDEX_BUFFER[i+2]][0], this.sourcePoints[FACE_MESH_INDEX_BUFFER[i+2]][1]);
          ctx.fill();
        }
       */
        
        for(let i=0; i<FACE_MESH_INDEX_BUFFER.length; i+=3){
          this.sourcePoints.push([points[FACE_MESH_INDEX_BUFFER[i]][0], points[FACE_MESH_INDEX_BUFFER[i]][1]]);
          this.sourcePoints.push([points[FACE_MESH_INDEX_BUFFER[i+1]][0], points[FACE_MESH_INDEX_BUFFER[i+1]][1]]);
          this.sourcePoints.push([points[FACE_MESH_INDEX_BUFFER[i+2]][0], points[FACE_MESH_INDEX_BUFFER[i+2]][1]]);
        }


       // this.sourcePoints

        this.homography.setSourcePoints(this.sourcePoints);
        this.imageLoaded = true;
      }
      this.sourceImage.src = '../assets/WIN_20220714_17_16_51_Pro.jpg';

  }

  customPerformanceMeasurement(meter: SequenceLogger, renderObject: RenderObject): boolean {
      return false;
  }

  init(data: any): void {

   
  }

  renderFrame(renderObject: RenderObject): void {
    let landmarks = Helper.scaleLandmarks(renderObject.data,318, 180);

    if (landmarks != null && this.imageLoaded){
      if(this.done) return;
      //this.done = true;
      let dstPoints = [];

      for(let i=0; i<landmarks.length; i++){
        dstPoints.push([landmarks[i].x,landmarks[i].y]);
      }

      const dest = [[255.98822021, 334.0974121 ],
      [256.01330565, 280.3133545 ],
      [255.98669435, 308.41445924],
      [246.84185789, 241.65325926],
      [256.07730104, 269.90386964],
      [255.95391846, 255.1055298 ],
      [255.75578307, 205.34374999],
      [148.33255004, 194.95117189],
      [255.97695923, 159.94778445],
      [255.99334717, 138.19851684],
      [256.01177979,  54.80960082],
      [256.01177979, 341.1118164 ],
      [256.00817869, 347.76269532],
      [256.01177979, 354.48217774],
      [255.98822021, 355.98233032],
      [255.98822021, 361.43820191],
      [255.98822021, 368.32513428],
      [255.98822021, 377.35372923],
      [255.98361206, 400.06195067],
      [255.90579226, 288.24627686],
      [242.57177733, 293.84191892],
      [ 53.71238328, 130.12017823],
      [187.35615539, 209.70291139],
      [173.4440918 , 211.46881106],
      [159.29344179, 209.64352415],
      [140.62489318, 199.23507692],
      [201.40133668, 206.69747927],
      [176.75981138, 176.13363645],
      [189.48812867, 177.19091799],
      [163.49285888, 177.79968261],
      [152.52633667, 181.03860475],
      [126.86950682, 210.33471677],
      [203.20716856, 431.49057009],
      [143.41017149, 192.30718996],
      [ 54.43072128, 204.7774658 ],
      [107.4815979 , 200.37274168],
      [182.17369078, 273.61587523],
      [241.5365143 , 333.00683592],
      [242.76736451, 348.25830077],
      [225.16992189, 336.50125123],
      [212.28390502, 341.26898191],
      [230.59149169, 348.60083005],
      [219.53074647, 349.53778079],
      [191.98515318, 372.63616942],
      [249.19909668, 280.38604739],
      [248.47410586, 270.02624512],
      [131.97567749, 161.01889039],
      [205.426178  , 233.04806518],
      [220.06732175, 280.89086915],
      [215.73222349, 273.27539062],
      [141.77075195, 272.4131775 ],
      [247.48544312, 255.78854369],
      [172.65254211, 144.83609011],
      [151.75270083, 150.14041139],
      [ 86.67903898,  99.23275756],
      [229.16096497, 154.93630981],
      [200.9036865 , 181.1906433 ],
      [181.49888609, 356.75341798],
      [ 34.46015928, 373.81378176],
      [226.68237307, 293.28692628],
      [234.03417969, 299.41351316],
      [195.57069399, 355.69201659],
      [200.90316774, 355.43194578],
      [141.86291502, 139.22918702],
      [216.34661868, 288.37530516],
      [197.59053041, 144.05838013],
      [196.14874266, 130.99008179],
      [169.69267272,  61.29357911],
      [117.72108457, 118.78552248],
      [186.62451174,  96.826355  ],
      [117.56646728, 153.36499026],
      [ 88.72294615, 142.71896361],
      [242.11404421, 341.09338378],
      [228.77593994, 342.28582764],
      [216.45414733, 345.03167724],
      [227.9976959 , 296.99377444],
      [198.70874025, 355.30804444],
      [206.3559723 , 361.74847411],
      [206.65805056, 355.3039551 ],
      [235.5415039 , 285.25518797],
      [220.75289917, 354.49139405],
      [231.51718139, 354.49139405],
      [243.39814758, 354.49139405],
      [238.50393677, 398.945282  ],
      [241.83244324, 376.94769285],
      [242.22055055, 367.54278564],
      [242.23846436, 360.76849367],
      [242.19290163, 355.98233032],
      [219.10630799, 355.98233032],
      [218.35725404, 360.21246336],
      [216.65895081, 364.46514893],
      [214.17420959, 368.6722412 ],
      [199.7286377 , 327.46136474],
      [  7.1444478 , 286.73742674],
      [255.95596314, 297.03527834],
      [211.55839539, 356.0447998 ],
      [209.72851564, 359.333374  ],
      [239.65696717, 307.9859009 ],
      [216.43724058, 300.02432251],
      [237.09695437, 304.017395  ],
      [190.52543642, 242.38796995],
      [171.29574584, 253.98937989],
      [210.77555845, 280.04608154],
      [123.99411011,  75.61010744],
      [148.87782287, 103.14035036],
      [167.59706117, 131.34182738],
      [204.54911805, 383.44757079],
      [226.1647339 , 133.97811891],
      [220.03967283,  96.17102049],
      [211.04537964,  55.75732424],
      [147.94496154, 204.26342774],
      [112.09574129, 222.93041992],
      [211.34439086, 204.27264404],
      [131.65312195, 181.98529055],
      [218.97471621, 224.23602294],
      [229.55007933, 274.91125489],
      [ 91.42272184, 234.26763914],
      [126.62169646, 234.083313  ],
      [146.56871035, 239.44958495],
      [170.40792847, 235.88455199],
      [188.80307005, 228.96997069],
      [204.26956175, 221.51934812],
      [243.92192077, 207.77267456],
      [ 96.89139558, 268.24908447],
      [117.22854615, 178.66290284],
      [251.25170898, 287.94931031],
      [207.19104005, 248.38809206],
      [  9.9681282 , 205.60076902],
      [218.23641969, 215.26068116],
      [203.26042173, 280.98406984],
      [136.43263242, 193.01223757],
      [224.82995604, 265.70648192],
      [ 16.54476739, 329.91076659],
      [214.55564882, 198.22335816],
      [236.94490051, 258.94244383],
      [122.35724641, 399.22943114],
      [101.48915098, 425.95227049],
      [ 55.06560133, 276.86657715],
      [ 94.00832369, 379.0115967 ],
      [ 68.81791688, 170.84570312],
      [197.51116943, 452.1748352 ],
      [251.37510682, 296.64154051],
      [195.78111268, 260.3893738 ],
      [ 89.29228974, 203.60754396],
      [163.21792604, 202.87231447],
      [175.80236815, 205.10565187],
      [202.80320737, 363.63110354],
      [ 96.19712067, 301.33145139],
      [220.66534426, 483.3612671 ],
      [163.32441713, 459.92193603],
      [136.3189697 , 445.28692628],
      [256.01177979,  97.57492065],
      [255.98822021, 488.67993165],
      [187.47903442, 204.19686892],
      [201.32199096, 202.51495363],
      [210.11097718, 200.23297121],
      [ 99.83641815, 175.15621949],
      [198.99647524, 185.48941041],
      [187.37254333, 182.25714109],
      [175.80236815, 181.94277955],
      [163.21792604, 183.47009275],
      [154.32447816, 185.93588255],
      [ 29.76409528, 163.36691282],
      [154.32447816, 198.37390136],
      [255.99385073, 316.63821409],
      [212.90905764, 319.58834836],
      [228.18917847, 289.83142088],
      [238.51213071, 317.76818847],
      [255.96057129, 179.98028564],
      [147.82412718, 419.81234739],
      [171.6628418 , 436.64382935],
      [225.54214477, 462.0385132 ],
      [ 65.68653107, 405.4737854 ],
      [209.29125975, 191.43371581],
      [233.27078246, 231.32211302],
      [255.93702697, 465.40289306],
      [192.22373965, 473.18630984],
      [ 58.47552108, 314.89126589],
      [229.71495055, 355.98233032],
      [229.38624573, 360.77160643],
      [228.92134093, 366.49371336],
      [227.75398257, 374.1665344 ],
      [220.1661377 , 392.60620119],
      [208.2749481 , 351.06457518],
      [205.17785646, 348.70733645],
      [200.90879821, 346.98394778],
      [188.3422699 , 339.92651366],
      [126.93657682, 307.88250732],
      [231.81823729, 215.4751892 ],
      [223.43270876, 184.262146  ],
      [213.07597353, 188.7815552 ],
      [211.6536255 , 354.49139405],
      [116.74521636, 349.98886108],
      [239.75321958, 180.56756593],
      [210.61734011, 411.81542968],
      [255.99436948, 240.55041505],
      [245.32684324, 226.63885496],
      [255.98669435, 225.09414671],
      [221.24134825, 252.71755981],
      [255.94163512, 443.86151122],
      [255.95545958, 420.72525025],
      [233.75308227, 419.43090821],
      [176.40908815, 381.66476442],
      [194.0014038 , 293.89312742],
      [191.63801574, 399.45471191],
      [163.68025206, 292.2178345 ],
      [182.86335754, 309.38623048],
      [151.18540954, 318.2494507 ],
      [229.24800108, 441.5882263 ],
      [210.42483523, 260.46618655],
      [160.74290468, 396.95770266],
      [181.31353759, 416.02713011],
      [166.16857912, 360.44439695],
      [ 96.81715395, 330.9055786 ],
      [143.24581908, 365.90490721],
      [ 68.51737974, 349.5429077 ],
      [172.42521667, 330.10330199],
      [220.10060119, 238.85925294],
      [233.23033144, 280.89495849],
      [223.80236815, 286.15475466],
      [239.2514496 , 271.32159421],
      [212.33255004, 171.6326294 ],
      [193.04754637, 165.26232909],
      [176.18328858, 163.91729736],
      [160.19250488, 165.0339966 ],
      [145.16531374, 170.59329224],
      [123.51795195, 195.98641966],
      [ 52.72883226, 240.00665283],
      [137.01734922, 217.37472532],
      [152.51405332, 221.78610227],
      [170.71820068, 222.14553836],
      [187.6106262 , 218.17138673],
      [202.7581482 , 213.34835814],
      [215.10195922, 210.03674317],
      [  3.87123205, 246.1578369 ],
      [221.66989138, 291.59320069],
      [234.8231659 , 245.29357911],
      [242.41459656, 279.42092897],
      [243.75704955, 288.68096922],
      [239.857666  , 284.18917847],
      [222.20338442, 298.16934205],
      [247.56121825, 288.24780273],
      [247.0312958 , 295.85870362],
      [218.34240722, 199.57708739],
      [224.76748657, 203.00543212],
      [230.43431091, 205.02221681],
      [148.33255004, 188.54553221],
      [141.65504456, 186.04696653],
      [265.14535521, 241.63739013],
      [363.66744996, 194.95117189],
      [269.42822267, 293.84191892],
      [458.28762819, 130.12017823],
      [324.64382935, 209.70291139],
      [338.5559082 , 211.46881106],
      [352.70657347, 209.64352415],
      [371.37509156, 199.23507692],
      [310.59457398, 206.69696046],
      [335.24020388, 176.13363645],
      [322.51187133, 177.19091799],
      [348.50714112, 177.79968261],
      [359.47366333, 181.03860475],
      [385.13253786, 210.33215334],
      [308.69403075, 431.54583741],
      [368.58981325, 192.30718996],
      [457.57080079, 204.77951048],
      [404.52197263, 200.37326049],
      [329.72698972, 273.6578369 ],
      [270.46350095, 333.00683592],
      [269.23519898, 348.25781248],
      [286.83007811, 336.50125123],
      [299.71661379, 341.26898191],
      [281.40850831, 348.60083005],
      [292.46874998, 349.53829955],
      [319.92422487, 372.78668211],
      [262.68161009, 280.20837402],
      [263.72967532, 269.95300291],
      [380.03045652, 161.02758789],
      [306.49908449, 232.94924928],
      [292.01306153, 280.87042237],
      [296.25958252, 273.21496581],
      [370.22055055, 272.41165164],
      [264.42034913, 255.81515505],
      [339.35412598, 144.85400392],
      [360.25549317, 150.15475466],
      [425.32095334,  99.23275756],
      [282.82162478, 154.91482542],
      [311.0963135 , 181.1906433 ],
      [330.45965578, 356.71398927],
      [477.53982546, 373.81378176],
      [285.31762693, 293.28692628],
      [277.96582031, 299.41351316],
      [316.42932127, 355.69201659],
      [311.08657838, 355.43194578],
      [370.14682004, 139.24505615],
      [295.63595581, 288.34149171],
      [314.41049196, 144.07012941],
      [315.85638426, 131.01364137],
      [342.27661133,  61.39596559],
      [394.28710938, 118.79473879],
      [325.39443968,  96.8954773 ],
      [394.44018555, 153.37268065],
      [423.28167726, 142.72256471],
      [269.88595579, 341.09338378],
      [283.22406006, 342.28582764],
      [295.54586793, 345.03167724],
      [284.00228879, 296.99377444],
      [313.29125975, 355.30804444],
      [305.64404296, 361.74847411],
      [305.34194944, 355.3039551 ],
      [276.4584961 , 285.25518797],
      [291.24710083, 354.49139405],
      [280.48281861, 354.49139405],
      [268.60186767, 354.49139405],
      [273.45407104, 398.92019656],
      [270.1675415 , 376.94769285],
      [269.77944945, 367.54278564],
      [269.76153564, 360.76849367],
      [269.80709837, 355.98233032],
      [292.89370726, 355.98233032],
      [293.64276122, 360.21246336],
      [295.34106445, 364.46514893],
      [297.82580567, 368.6722412 ],
      [312.29183959, 327.63391114],
      [504.85556029, 286.73742674],
      [300.44158935, 356.0447998 ],
      [302.27047731, 359.333374  ],
      [272.34048461, 307.98693847],
      [295.56121825, 299.99871826],
      [274.9004822 , 304.01843261],
      [321.30200197, 242.35623168],
      [340.78002929, 253.92691041],
      [301.23724365, 279.99334717],
      [388.00588989,  75.61010744],
      [363.13598633, 103.17208863],
      [344.41421507, 131.3694763 ],
      [307.40939331, 383.49053957],
      [285.83218386, 133.97607424],
      [291.99563597,  96.1899414 ],
      [301.14099123,  55.83053588],
      [364.05505372, 204.26342774],
      [399.90783693, 222.92736814],
      [300.67047117, 204.25317381],
      [380.34942628, 181.98834227],
      [292.9438782 , 224.0778198 ],
      [282.55642701, 274.72384645],
      [420.5783081 , 234.26867676],
      [385.38342287, 234.07717893],
      [365.44357299, 239.42501832],
      [341.56185912, 235.864563  ],
      [323.12371825, 228.94284058],
      [307.64135741, 221.426178  ],
      [268.02227784, 207.6810303 ],
      [415.10296632, 268.25012209],
      [394.77554319, 178.66702269],
      [260.67303465, 288.11163331],
      [304.79000852, 248.3322754 ],
      [502.03186033, 205.60076902],
      [293.63198853, 215.04000855],
      [308.73342894, 280.92825318],
      [375.56735232, 193.01223757],
      [287.03283692, 265.73669432],
      [495.45523072, 329.91076659],
      [297.46432497, 198.22592164],
      [275.31674194, 258.75714109],
      [389.61459348, 399.23352049],
      [410.51083372, 425.95227049],
      [456.92977905, 276.86962893],
      [417.97171021, 379.01312256],
      [443.18463135, 170.84774779],
      [314.4058838 , 452.22195436],
      [260.58392335, 296.6722412 ],
      [316.38629151, 260.25781248],
      [422.71130373, 203.60958863],
      [348.78207396, 202.87231447],
      [336.19763185, 205.10565187],
      [309.19680788, 363.63110354],
      [415.78802488, 301.3319702 ],
      [290.82266235, 483.61727903],
      [348.67608643, 459.92193603],
      [375.6810303 , 445.28692628],
      [324.52096558, 204.19686892],
      [310.67800904, 202.51495363],
      [301.90591432, 200.22375491],
      [412.16818237, 175.15930173],
      [313.0035095 , 185.48941041],
      [324.62744141, 182.25714109],
      [336.19763185, 181.94277955],
      [348.78207396, 183.47009275],
      [357.67550659, 185.93588255],
      [482.23590088, 163.36691282],
      [357.67550659, 198.37390136],
      [299.09863281, 319.54278564],
      [283.81082153, 289.83142088],
      [273.48684692, 317.76770017],
      [364.14361574, 419.82720947],
      [340.29055785, 436.66995241],
      [286.25918577, 462.14758303],
      [446.31347656, 405.4737854 ],
      [302.71182249, 191.43371581],
      [278.70260618, 231.21099853],
      [319.77624509, 473.18630984],
      [453.51425172, 314.89483643],
      [282.2850647 , 355.98233032],
      [282.61376952, 360.77160643],
      [283.07864381, 366.49371336],
      [284.24600218, 374.1665344 ],
      [291.81134034, 392.72192384],
      [303.7199402 , 351.06610109],
      [306.82214354, 348.70733645],
      [311.09118653, 346.98394778],
      [323.55224612, 339.71200563],
      [385.04089354, 307.87329101],
      [280.17971804, 215.24224855],
      [288.5345154 , 184.23193359],
      [298.92660521, 188.7815552 ],
      [300.3463745 , 354.49139405],
      [395.22048952, 349.99194337],
      [272.17767332, 180.47128294],
      [301.24594115, 411.8737793 ],
      [266.64807127, 226.59329224],
      [290.80831908, 252.66125486],
      [278.16088868, 419.45855713],
      [335.52230835, 381.70367432],
      [317.95660401, 293.89721682],
      [320.28671263, 399.51974487],
      [348.26138307, 292.20812989],
      [329.09515382, 309.42105103],
      [360.78744504, 318.22335816],
      [282.63015747, 441.64709473],
      [301.60485842, 260.42214968],
      [351.20382689, 396.9827881 ],
      [330.616333  , 416.07168579],
      [345.77560422, 360.43673708],
      [415.15930173, 330.90814208],
      [368.70245361, 365.90948485],
      [443.46981811, 349.54495237],
      [339.55175782, 330.03366088],
      [291.88198851, 238.75891113],
      [278.81573489, 280.76849367],
      [288.13259889, 286.09790039],
      [272.37734984, 271.43170166],
      [299.65875246, 171.6106262 ],
      [318.95193482, 165.2628479 ],
      [335.8187561 , 163.92346194],
      [351.81158446, 165.04113772],
      [366.83877565, 170.59890749],
      [388.48358154, 195.98693847],
      [459.2706604 , 240.00973512],
      [374.98471071, 217.3680725 ],
      [359.48236083, 221.77944945],
      [341.26080323, 222.13940429],
      [324.35455324, 218.15704346],
      [309.18450929, 213.29254149],
      [296.78488161, 209.89184568],
      [508.12927247, 246.1578369 ],
      [290.40231322, 291.54302976],
      [277.17938232, 245.19628908],
      [269.60076902, 279.61242675],
      [268.24346926, 288.68096922],
      [272.14285276, 284.18917847],
      [289.81042478, 298.15246582],
      [264.35122683, 288.28363039],
      [264.94567869, 295.87304689],
      [293.68063355, 199.58117678],
      [287.07736207, 202.40997315],
      [281.47506714, 204.67251589],
      [363.66744996, 188.54553221],
      [370.3449707 , 186.04696653]];

      const ctx = this.domRenderer.getContext('2d');
      ctx.clearRect(0,0,500,500);
      
      
  
      
      /*for(let i=0; i<FACE_MESH_INDEX_BUFFER.length; i+=3){
        ctx.beginPath();
        ctx.moveTo(FACE_MESH_UV[FACE_MESH_INDEX_BUFFER[i]][0]*500, FACE_MESH_UV[FACE_MESH_INDEX_BUFFER[i]][1]*500);
        ctx.lineTo(FACE_MESH_UV[FACE_MESH_INDEX_BUFFER[i+1]][0]*500, FACE_MESH_UV[FACE_MESH_INDEX_BUFFER[i+1]][1]*500);
        ctx.lineTo(FACE_MESH_UV[FACE_MESH_INDEX_BUFFER[i+2]][0]*500, FACE_MESH_UV[FACE_MESH_INDEX_BUFFER[i+2]][1]*500);
        ctx.fill();
      }*/

      const target = [];


      for(let i=0; i<FACE_MESH_INDEX_BUFFER.length; i+=3){
        target.push([landmarks[FACE_MESH_INDEX_BUFFER[i]].x, landmarks[FACE_MESH_INDEX_BUFFER[i]].y]);
        target.push([landmarks[FACE_MESH_INDEX_BUFFER[i+1]].x, landmarks[FACE_MESH_INDEX_BUFFER[i+1]].y]);
        target.push([landmarks[FACE_MESH_INDEX_BUFFER[i+2]].x, landmarks[FACE_MESH_INDEX_BUFFER[i+2]].y]);
      }



     
      this.homography.setDestinyPoints(target);
      const resultImage = this.homography.warp(this.sourceImage);

      const c = document.createElement('canvas');
      const img = new ImageData(resultImage.width, resultImage.height);
      img.data.set(resultImage.data);

      this.domRenderer.getContext('2d').clearRect(0,0,318,180);
      this.domRenderer.getContext('2d').putImageData(img, 0, 0);
      
    }
    
  }

    destruct(): void {}
    
}